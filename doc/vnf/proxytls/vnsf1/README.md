# ProxyTLS

## Overview

vNSF to offer HTTP-based TLS proxy functionality for security use.

It provide 2 main submodules:

* Proxy TLS itself. Based on the VNF [PSA-Rencrypt](https://github.com/SECURED-FP7/secured-psa-reencrypt) (*Personal Security Application*) created in FP7 SECURED project; enhanced and integrated with SHIELD functionality. This module acts as a HTTP Proxy and allows to inspect HTTPS traffic content.
* ACME-STAR. Includes a basic client ACME-STAR IETF draft implementation in order to obtain short-term life valid Certificates from a CA. This process avoids CA impersonation by the proxy TLS and generates confidence in the process.

## Installation

TLS Proxy is provided as an vNSF image and descriptors to be compiled and executed in vNSFO format.
If needed, a manual process of creation is provided starting from a clean Ubuntu 16.04TLS image.


## Running TLS proxy

Manual execution is possible:

```
$ sh secured-psa-reencrypt/PSA/scripts/start_demo.sh â€“options
 -h | --help -> Prints help.
 -log -> Path and file name for log file
 -alert -> Path and file name for alert log file.
 -bb -> Boolean indicating if black lists are used: true/false (default).
 -bm -> Boolean indicating if monitor lists are used: true (default)/false.
 -t -> Refresh time for blacklists in hours. Default 24h.
 -dirB -> Directory with the block lists.
 -dirM -> Directory with the monitor lists
```

This script calls the configuration script (```load_configuration.py```), making a copy of a default configuration file (```psaconfig```) with the updated parameters (```psaconfig_updated```). After that, it calls (```mitdump ```)

## Monitoring/Blocking URLs list

Default directories for monitoring and blocking URL are:

```
dbl_dir_blo="/home/vnsf-proxy/secured-psa-reencrypt/PSA/scripts/block"
dbl_dir_mon="/home/vnsf-proxy/secured-psa-reencrypt/PSA/scripts/monitor"
```

Expected format is a list of URLS (one URL per line). For instance:

```
https://first.com
http://second.com
https://third.com
http://fourth.com
https://fifth.com
https://sixth.com
https://seventh.com
```

## Apache Spot PROXY logs

Logs generated by ProxyTLS are compatible with Apache Spot PROXY logs type and based on BlueCoat. Two types of logs are available based on the configuration:

1. Alert file generated for each URL detected or blocked:
```
path_alert="/home/vnsf-proxy/secured-psa-reencrypt/PSA/scripts/spot_ingest_alerts.log"
```
1. Logs with URLs (if general monitoring mode is activated logs):
```
path_log="/home/vnsf-proxy/secured-psa-reencrypt/PSA/scripts/spot_ingest_logs.log"
```

## Internal API

In order to attend requests via vNSFO and OSM Juju charm, an internal API is exposed.
This API starts upon the vNSF boot. Manual execution of the API server can be done with the following command:

```
$ secured-psa-reencrypt/PSA/scripts/restful.py
```
